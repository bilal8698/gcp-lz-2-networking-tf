# Copyright 2024 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Network CIDR Allocations - Confidential
# CIDR blocks for Shared VPCs and Platform VPCs
# Source: Carrier GCP LLD v1.1 (Section 1.1 & 1.2)

# Shared VPC CIDR Allocations (Model 1 & Model 3)
# Regional /16 blocks reserved for subnet vending
cidr_allocations:
  us-east4:
    m1p: "10.150.0.0/16"    # Model 1 Production
    m1np: "10.151.0.0/16"   # Model 1 Non-Production
    m3p: "10.152.0.0/16"    # Model 3 Production
    m3np: "10.153.0.0/16"   # Model 3 Non-Production
  
  us-central1:
    m1p: "10.100.0.0/16"
    m1np: "10.101.0.0/16"
    m3p: "10.102.0.0/16"
    m3np: "10.103.0.0/16"
  
  europe-west3:
    m1p: "10.173.0.0/16"
    m1np: "10.174.0.0/16"
    m3p: "10.175.0.0/17"    # /17 for M3P EMEA
    m3np: "10.175.128.0/17" # /17 for M3NP EMEA
  
  europe-west1:
    m1p: "10.177.0.0/16"
    m1np: "10.178.0.0/16"
    m3p: "10.179.0.0/17"    # /17 for M3P EMEA
    m3np: "10.179.128.0/17" # /17 for M3NP EMEA
  
  asia-southeast1:
    m1p: "10.109.0.0/16"
    m1np: "10.110.0.0/16"
    m3p: "10.111.0.0/17"    # /17 for M3P APAC
    m3np: "10.111.128.0/17" # /17 for M3NP APAC
  
  asia-east2:
    m1p: "10.115.0.0/16"
    m1np: "10.116.0.0/16"
    m3p: "10.117.0.0/17"    # /17 for M3P APAC
    m3np: "10.117.128.0/17" # /17 for M3NP APAC

# Infrastructure Subnet CIDR Allocations (Platform VPCs)
# Changed from /24 to /19 as per manager requirement
# Source: Carrier GCP LLD v1.1 (Section 1.2)
infra_subnet_cidrs:
  us-east4:
    transit: "10.154.0.0/19"      # Transit VPC base range (contains .0.0/24)
    sec_data: "10.154.8.0/19"     # Security Data VPC base range (contains .8.0/24)
    sec_mgmt: "10.154.16.0/19"    # Security Mgmt VPC base range (contains .16.0/24)
    shared_svcs: "10.154.32.0/19" # Shared Services VPC base range (contains .32.0/24)
  
  us-central1:
    transit: "10.154.1.0/19"
    sec_data: "10.154.9.0/19"
    sec_mgmt: "10.154.17.0/19"
    shared_svcs: "10.154.33.0/19"
  
  europe-west1:
    transit: "10.154.2.0/19"
    sec_data: "10.154.10.0/19"
    sec_mgmt: "10.154.18.0/19"
    shared_svcs: "10.154.34.0/19"
  
  europe-west3:
    transit: "10.154.3.0/19"
    sec_data: "10.154.11.0/19"
    sec_mgmt: "10.154.19.0/19"
    shared_svcs: "10.154.35.0/19"
  
  asia-east2:
    transit: "10.154.4.0/19"
    sec_data: "10.154.12.0/19"
    sec_mgmt: "10.154.20.0/19"
    shared_svcs: "10.154.36.0/19"
  
  asia-southeast1:
    transit: "10.154.5.0/19"
    sec_data: "10.154.13.0/19"
    sec_mgmt: "10.154.21.0/19"
    shared_svcs: "10.154.37.0/19"

# Platform VPC Additional Ranges (from LLD Section 1.2)
# Global Shared Services VPC - Multiple /19 blocks
shared_services_ranges:
  slot1: "10.154.64.0/19"   # Regional Shared Services
  slot2: "10.154.96.0/19"
  slot3: "10.154.128.0/19"
  slot4: "10.154.160.0/19"
  slot5: "10.154.192.0/19"
  slot6: "10.154.224.0/19"

# Network Subnet Vending Configuration
# Add subnet requests here for automated provisioning with IPAM integration

subnets:
  # Example subnet vending request
  # Uncomment and modify to request new subnets
  
  # - region: "us-east4"
  #   model: "m1p"                              # m1p, m1np, m3p, m3np
  #   business_unit: "whq"                      # Business unit abbreviation
  #   application: "agtspace"                   # Application name
  #   size: "S"                                 # S=/26 (64 IPs), M=/25 (128 IPs), L=/24 (256 IPs)
  #   cidr_block: "10.150.1.0/26"              # Allocated by Blue Cat via APIGEE
  #   
  #   # Mandatory labels
  #   cost_center: "109985"
  #   owner: "ai-platform_carrier_com"
  #   leanix_app_id: "app-05022"
  #   
  #   # Optional configurations
  #   private_ip_google_access: true           # Default: true
  #   flow_logs_sampling: 0.5                  # Default: 0.5 (50%)
  #   flow_logs_aggregation_interval: "INTERVAL_5_SEC"  # Default: 5 seconds
  #   
  #   # Optional additional labels
  #   additional_labels:
  #     environment: "prd"
  #     criticality: "high"

  # Example: AI CoE Production Subnet in US-East4
  # - region: "us-east4"
  #   model: "m1p"
  #   business_unit: "whq"
  #   application: "aicoe-ml"
  #   size: "M"
  #   cidr_block: "10.150.2.0/25"
  #   cost_center: "109985"
  #   owner: "ai-platform_carrier_com"
  #   leanix_app_id: "app-02064"

  # Example: Carrier Energy DMZ Subnet in Europe
  # - region: "europe-west3"
  #   model: "m3p"
  #   business_unit: "energy"
  #   application: "energy-api"
  #   size: "S"
  #   cidr_block: "10.174.1.0/26"
  #   cost_center: "100000"
  #   owner: "energy_team_at_carrier_com"
  #   leanix_app_id: "app-energy-001"

# Subnet Vending Workflow:
#
# 1. Create a new branch: git checkout -b feature/add-subnet-{app}-{region}
# 2. Add subnet configuration above (uncomment and modify example)
# 3. IMPORTANT: Get CIDR allocation from Blue Cat IPAM before committing
#    - Contact network team or use APIGEE endpoint to request allocation
#    - Blue Cat will allocate IP range from available pool
# 4. Commit changes: git commit -m "feat: add subnet for {app} in {region}"
# 5. Push and create PR: git push origin feature/add-subnet-{app}-{region}
# 6. GitHub Actions will run terraform plan and post results to PR
# 7. Review plan output, ensure CIDR is correct and no conflicts
# 8. After approval and merge, subnet will be created automatically
# 9. Blue Cat IPAM will be updated with the new subnet allocation
#
# T-Shirt Sizing Guidelines:
# - Small (S): /26 = 64 IPs - Default for most applications
# - Medium (M): /25 = 128 IPs - For applications with 30-100 resources
# - Large (L): /24 = 256 IPs - For large applications (requires approval)
# - Exception: Larger than /24 requires architecture review board approval
#
# Mandatory Tags (Required for all subnets):
# - cost_center: Cost center code for chargeback
# - owner: Team/individual responsible (email format with _at_)
# - application: Application name (lowercase, hyphen-separated)
# - leanix_app_id: LeanIX application ID for architecture inventory
#
# VPC Flow Logs (Enabled by default):
# - Helps with troubleshooting and security analysis
# - Sampling: 50% (configurable)
# - Aggregation: 5 seconds (configurable)
# - Metadata: All fields included (latency, RTT, etc.)
